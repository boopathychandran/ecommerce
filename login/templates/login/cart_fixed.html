{% extends "base.html" %}
{% load static %}

{% block title %}Shopping Cart | Chandran Electronics{% endblock %}

{% block extra_css %}
<style>
    .cart-entry {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        padding: 1.5rem;
        background: white;
        border-radius: var(--border-radius);
        border: 1px solid rgba(0, 0, 0, 0.05);
        margin-bottom: 1.5rem;
        transition: transform 0.2s;
    }

    .cart-entry:hover {
        transform: scale(1.01);
        border-color: var(--primary-glow);
    }

    .qty-btn {
        width: 30px;
        height: 30px;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
    }

    .qty-btn:hover {
        background: #f1f5f9;
        border-color: var(--primary);
        color: var(--primary);
    }
</style>
{% endblock %}

{% block content %}
<div class="container" style="padding: 4rem 2rem;">
    <div class="animate-in">
        <h1 class="section-title" style="margin-bottom: 2rem;">Your System Cart</h1>

        <div style="display: grid; grid-template-columns: 1fr 350px; gap: 3rem;">
            <!-- Cart Items -->
            <div>
                {% if cart %}
                {% for entry in cart %}
                <div class="cart-entry">
                    <div
                        style="width: 100px; height: 100px; border-radius: 12px; overflow: hidden; background: #f1f5f9; border: 1px solid rgba(0,0,0,0.05); flex-shrink: 0;">
                        {% if entry.image_url %}
                        <img src="{{ entry.image_url }}" alt="{{ entry.name }}"
                            style="width: 100%; height: 100%; object-fit: cover;">
                        {% else %}
                        <img src="{% static 'images/default.jpg' %}"
                            style="width: 100%; height: 100%; object-fit: cover;">
                        {% endif %}
                    </div>

                    <div style="flex: 1;">
                        <h3 style="margin: 0 0 0.5rem 0; font-family: var(--font-heading); font-size: 1.25rem;">{{ entry.name }}</h3>
                        <div style="color: var(--text-muted); font-weight: 500;">₹{{ entry.price }} per unit</div>
                    </div>

                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <!-- AJAX Quantity Controls -->
                        <div
                            style="display: flex; align-items: center; gap: 0.75rem; background: #f8fafc; padding: 5px; border-radius: 10px; border: 1px solid #e2e8f0;">
                            <button class="qty-btn" data-action="update-quantity" data-slug="{{ entry.product_slug }}"
                                data-update-action="decrease" style="border:none;">-</button>
                            <span class="qty-display" style="font-weight: 700; width: 20px; text-align: center;">{{ entry.quantity }}</span>
                            <button class="qty-btn" data-action="update-quantity" data-slug="{{ entry.product_slug }}"
                                data-update-action="increase" style="border:none;">+</button>
                        </div>
                    </div>

                    <div style="width: 120px; text-align: right;">
                        <div class="item-total-price" style="font-weight: 800; font-size: 1.25rem; color: var(--primary);">₹{{ entry.total_price }}</div>
                    </div>

                    <form method="POST" action="{% url 'remove_from_cart' entry.product_id %}" style="margin: 0;">
                        {% csrf_token %}
                        <button type="submit" class="btn-secondary"
                            style="height: 40px; width: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #ef4444;">
                            <span class="material-icons">delete_outline</span>
                        </button>
                    </form>
                </div>
                {% endfor %}
                {% else %}
                <div class="feature-card" style="text-align: center; padding: 5rem 2rem; align-items: center;">
                    <span class="material-icons"
                        style="font-size: 4rem; color: #cbd5e1; margin-bottom: 1.5rem;">shopping_basket</span>
                    <h2 style="font-family: var(--font-heading);">The Matrix is empty.</h2>
                    <p style="color: var(--text-muted); margin-bottom: 2rem;">Looks like you haven't added any tech to
                        your system yet.</p>
                    <a href="{% url 'ecommerce' %}" class="btn-primary"
                        style="text-decoration: none; width: auto; padding: 0 2.5rem;">Initialize Shopping</a>
                </div>
                {% endif %}
            </div>

            <!-- Summary Sidebar -->
            <div style="position: sticky; top: 120px; align-self: start;">
                <div class="feature-card" style="padding: 2rem; gap: 1.5rem;">
                    <h2 style="font-family: var(--font-heading); font-size: 1.5rem; margin-bottom: 0.5rem;">Order
                        Summary</h2>

                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div style="display: flex; justify-content: space-between; color: var(--text-muted);">
                            <span>Subtotal</span>
                            <span id="cart-subtotal">₹{{ original_total|floatformat:2 }}</span>
                        </div>

                        {% if coupon %}
                        <div style="display: flex; justify-content: space-between; color: #10b981; font-weight: 600;">
                            <span>Discount ({{ coupon }})</span>
                            <span id="cart-discount-amount">- ₹{{ discount_amount|floatformat:2 }}</span>
                        </div>
                        {% endif %}

                        <div style="display: flex; justify-content: space-between; color: var(--text-muted);">
                            <span>Shipping</span>
                            <span>Free</span>
                        </div>

                        <div style="height: 1px; background: rgba(0,0,0,0.05); margin: 0.5rem 0;"></div>

                        <div
                            style="display: flex; justify-content: space-between; font-size: 1.5rem; font-weight: 800; color: var(--text-main);">
                            <span>Total</span>
                            <span id="cart-total" style="color: var(--primary);">₹{{ total|floatformat:2 }}</span>
                        </div>
                    </div>

                    <form action="{% url 'apply_coupon' %}" method="POST"
                        style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                        {% csrf_token %}
                        <input type="text" name="code" placeholder="Promo Code"
                            style="flex: 1; padding: 10px 15px; border-radius: 10px; border: 1px solid #e2e8f0; outline: none; font-size: 0.9rem;">
                        <button type="submit" class="btn-secondary"
                            style="padding: 0 15px; border-radius: 10px;">Apply</button>
                    </form>

                    <a href="{% url 'address' %}" class="btn-primary"
                        style="text-decoration: none; margin-top: 1rem; height: 55px; font-size: 1.1rem; border-radius: 15px;">
                        Proceed to Checkout
                    </a>

                    <div
                        style="margin-top: 1.5rem; padding: 1rem; background: #f8fafc; border-radius: 12px; border: 1px solid #e2e8f0; font-size: 0.85rem; color: var(--text-muted); display: flex; gap: 10px; align-items: start;">
                        <span class="material-icons" style="color: var(--primary);">security</span>
                        <span>Secure payments powered by razorpay. SSL encrypted checkout.</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}